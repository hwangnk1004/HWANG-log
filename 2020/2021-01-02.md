## 2021-01-02

### 오늘 할 일

  - [x] 안드로이드 공부



## 결과



#### 안드로이드 공부

* Room 데이터베이스를 얻는 일반적인 프로세스
	- Room 데이터베이스를 확장하는 공용 추상 클래스를 만든다.
	- 클래스에 데이터베이스와 인수에 어노테이션 추가
	- 앱은 동일한 Room 데이터베이스의 인스턴스 하나만 필요하다. 그래서 Room 데이터베이스를 싱글 톤으로 만든다.
	- Room의 데이터베이스 빌더를 사용하여 데이터베이스가 없는 경우에만 데이터 베이스를 만든다. 그렇지 않으면 기존 데이터베이스를 반환한다.

* Process
	- 모바일 장치에는 프로세스가 있으며 요즘에는 대부분 동시에 프로세스를 실행하는 여러 하드웨어 프로세스가 있다. 이를 다중 처리라고 한다.
	- 프로세스를 보다 효율적으로 사용하려면 운영체제는 응용프로그램이 프로세스 내에서 둘 이상의 실행 스레드를 만든다. 이를 멀티 스레딩이라고 한다. 동시에 여러 권의 책을 읽는 것으로 생각할 수 있다. (그림) 독자는 프로세스를 나타내고 각 책은 필요한 코드를 나타낸다.
	- Anroid에서 기본 스레드는 UI에 대한 모든 업데이트를 처리하는 단일 스레드이다.
	- 메인스레드 또한 호출하는 스레드 이다.
	- 모든 클릭 핸들러와 기타 UI 및 라이프 사이클 콜백. 이를 UI 스레드라고하는 이유이다.
	- UI 스레드는 기본스레드이다. 명시적으로 전환하지 않는 한 스레드를 사용하거나 다른 스레드에서 실행되는 클래스를 사용한다. 
	- UI 스레드는 훌륭한 사용자 경험을 보장하기 위해 원활하게 실행되어야 한다.
	- 메인 스레드는 16 밀리 초마다 또는 더 자주 화면을 업데이트 해야한다. 또는 초당 약 60프레임이다. 이 속도에서 인간은 프레임의 변경이 완전히 매끄럽다 고 인식한다.
	- 따라서 Android에서는 UI 스레드를 차단하지 않는것이 중요하다.
	- 예를 들어 업데이트할 데이터베이스는 많은 경우 16초 이상 걸린다.
	- 인터넷에서 데이터를 가저오는 것과 같은 큰 파일 읽기, 또는 데이터베이스에 데이터 쓰기 등
	- 따라서 메인스레드에서 이와 같은 코드를 호출하면 앱이 일시중지 될 수 있다.
	- 메인 또는 UI 스레드에서 장기 실행 작업을 수행해서는 안된다.

* room을 이용할 때 주의할점
	- 메인스레드를 이용해 많은 양의 쿼리를 하다보면 오랜기간동안 UI가 동작하지 않을 수 있기 때문에 막혀있다. 따라서 UI스레드 이외에서 동작해야한다.
	- 비동기 처리를 위해 몇가지 선택을 할 수 있다.
		* AyncTask, RxJava, Coroutine, JavaThread

* 코루틴
	- 두가지의 dispatcher가 있다.
		* uiDispatcher: 안드로이드 UI스레드에서 실행
		* bgDisPatcher : BG 스레드에서 실행
		




	- 메인 스레드에서 작업을 수행하는 방법에 대한 몇가지 옵션이 있다.
	- 장기 실행 작업을 수행하기 위한 패턴, 메인 스레드를 차단하는 콜백
	- 콜백을 사용하여 백그라운드 스레드에서 장기 실행 작업을 시작할 수 있다.
	- 작업이 완료되면 인수로 제공되는 콜백은 메인스레드에 결과를 알리기위해 호출된다.
	- 콜백은 훌륭한 패턴이다.
	- 그러나 몇 가지 단점이 있다.
	- 콜백은 많이 사용하는 코드는 읽기 어렵고 추론하기 더 어려워 질 수 있다.
	- 코드는 순차적으로 보이지만 콜백 코드는 비동기 시간에 실행된다.
	- 또한 콜백은 예외와 같은 일부 언어 기능의 사용을 허용하지 않는다.

	- 코틀린에는 장기 실행 작업을 우아하고 효율적으로 처리하는 코루틴이 있다.
	- 코루틴을 사용하면 콜백 기반 코드를 순차 코드로 변환 할 수 있다.
	- 순차적으로 작성된 코드는 일반적으로 읽기가 더 쉽다.
	- 예외와 같은 언어 기능도 사용할 수 있다.
	- 콜백은 다른 예외 처리기를 통해 오류를 전달해야 한다.
	- 결국 코루틴과 콜백은 같은 일을 한다.

	- 코루틴 특징
		* 비동기식, 비 차단식, 일시 중단 함수를 사용하여 비동기 코드를 순차적으로 만든다.







## tags
-  \#kotlin, \#android 

